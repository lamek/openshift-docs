// Module included in the following assemblies:
//
// getting_started_moa/creating-first-moa-cluster.adoc


[id="moa-accessing-your-cluster"]
= Accessing your cluster

To login to your cluster, you must configure an Identity Provider (IDP).

This guide uses Github as an example IDP. 

For other supported IDPs, run `moactl create idp --help`, and consult the OpenShift documentation on [configuring an IDP](https://docs.openshift.com/container-platform/latest/authentication/understanding-identity-provider.html#supported-identity-providers) for more information.

.Procedure

. Add an IDP
.. Run the following command to create an IDP backed by Github. Follow the prompts from the output to access your [Github developer settings](https://github.com/settings/developers) and configure a new OAuth application.
+
[source, bash]
----
$ moactl create idp --cluster rh-moa-test-cluster1 --type github                                                                                               
I: Loading cluster 'rh-moa-test-cluster1'                                                                                                                                                               
I: Loading identity providers for cluster 'rh-moa-test-cluster1'                                                                                                                                        
To use GitHub as an identity provider, you must first register the application:                                                                                                                 
? List of GitHub organizations or teams that will have access to this cluster: openshift-online                                                                                                 
* Open the following URL: https://github.com/organizations/openshift-online/settings/applications/new?oauth_application%5Bcallback_url%5D=https%3A%2F%2Foauth-openshift.apps.rh-moa-test-cluster1.j9n4.s
1.devshift.org%2Foauth2callback%2Fgithub-1&oauth_application%5Bname%5D=rh-moa-test-cluster1&oauth_application%5Burl%5D=https%3A%2F%2Fconsole-openshift-console.apps.rh-moa-test-cluster1.j9n4.s1.devshift.org   
* Click on 'Register application'                                                                                                                                                               
? Copy the Client ID provided by GitHub: &lt;my-github-client-id&gt;                                                                                                                                   
? Copy the Client Secret provided by GitHub: &lt;my-github-client-secret&gt;                                                                                                           
I: Configuring IDP for cluster 'rh-moa-test-cluster1'                                                                                                                                                   
I: Identity Provider 'github-1' has been created. You need to ensure that there is a list of cluster administrators defined. See `moactl user add --help` for more information. To login into th
e console, open https://console-openshift-console.apps.rh-moa-test-cluster1.j9n4.s1.devshift.org and click on github-1
----
+
The IDP can take 1-2 minutes to be configured within your cluster.
.. Run the following command to verify that your IDP has been configured correctly:
+
[source, bash]
----
$ moactl list idps --cluster rh-moa-test-cluster1
NAME        TYPE      AUTH URL
github-1    GitHub    https://oauth-openshift.apps.rh-moa-test-cluster1.j9n4.s1.devshift.org/oauth2callback/github-1
----
+
. Log in to your cluster
.. Run the following command to get the `Console URL` of your cluster:
+
[source, bash]
----
$ moactl describe cluster rh-moa-test-cluster1
Name:        rh-moa-test-cluster1
ID:          1de87g7c30g75qechgh7l5b2bha6r04e
External ID: 34322be7-b2a7-45c2-af39-2c684ce624e1
API URL:     https://api.rh-moa-test-cluster1.j9n4.s1.devshift.org:6443
Console URL: https://console-openshift-console.apps.rh-moa-test-cluster1.j9n4.s1.devshift.org
Nodes:       Master: 3, Infra: 3, Compute: 4
Region:      us-east-2
State:       ready
Created:     May 27, 2020
----
+
.. Navigate to the `Console URL` and log in using your Github credentials.
.. In the top right of the OpenShift console, click your name and click **Copy Login Command**.
.. Select the name of the IDP you added (in our case **github-1**), and click **Display Token**.
.. Copy and paste the `oc` login command into your terminal.
+
[source, bash]
----
$ oc login --token=z3sgOGVDk0k4vbqo_wFqBQQTnT-nA-nQLb8XEmWnw4X --server=https://api.rh-moa-test-cluster1.j9n4.s1.devshift.org:6443
Logged into "https://api.rh-moa-test-cluster1.j9n4.s1.devshift.org:6443" as "rh-moa-test-user" using the token provided.

You have access to 67 projects, the list has been suppressed. You can list all projects with 'oc projects'

Using project "default".
----
.. Run a simple `oc` command to verify everything is setup properly and you are logged in.
+
[source, bash]
----
$ oc version
Client Version: 4.4.0-202005231254-4a4cd75
Server Version: 4.3.18
Kubernetes Version: v1.16.2
----